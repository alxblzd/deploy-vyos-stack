{# Forward filter rules - zone-like behavior without zones #}
set firewall ipv4 forward filter default-action drop
set firewall ipv4 forward filter description 'Zone-based firewall using forward filter'

{# Rule 10: Allow established/related globally #}
set firewall ipv4 forward filter rule 10 action accept
set firewall ipv4 forward filter rule 10 description 'Allow established/related connections'
set firewall ipv4 forward filter rule 10 state established
set firewall ipv4 forward filter rule 10 state related

{# Rule 100-101: MGMT -> All VLANs (SSH/RDP/ICMP) #}
set firewall ipv4 forward filter rule 100 action accept
set firewall ipv4 forward filter rule 100 description 'MGMT can SSH/RDP to all VLANs'
set firewall ipv4 forward filter rule 100 source address 10.0.10.0/24
set firewall ipv4 forward filter rule 100 protocol tcp
set firewall ipv4 forward filter rule 100 destination port 22,3389

set firewall ipv4 forward filter rule 101 action accept
set firewall ipv4 forward filter rule 101 description 'MGMT can ping all VLANs'
set firewall ipv4 forward filter rule 101 source address 10.0.10.0/24
set firewall ipv4 forward filter rule 101 protocol icmp

{# Rule 110: MGMT -> WAN (Full access) #}
set firewall ipv4 forward filter rule 110 action accept
set firewall ipv4 forward filter rule 110 description 'MGMT full internet access'
set firewall ipv4 forward filter rule 110 source address 10.0.10.0/24
set firewall ipv4 forward filter rule 110 outbound-interface name {{ wan_interface }}

{# Rule 200-201: DMZ-Cloud -> WAN (Limited) #}
set firewall ipv4 forward filter rule 200 action accept
set firewall ipv4 forward filter rule 200 description 'DMZ-Cloud HTTP/HTTPS for updates'
set firewall ipv4 forward filter rule 200 source address 10.0.11.0/24
set firewall ipv4 forward filter rule 200 outbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 200 protocol tcp
set firewall ipv4 forward filter rule 200 destination port 80,443

set firewall ipv4 forward filter rule 201 action accept
set firewall ipv4 forward filter rule 201 description 'DMZ-Cloud DNS'
set firewall ipv4 forward filter rule 201 source address 10.0.11.0/24
set firewall ipv4 forward filter rule 201 outbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 201 protocol udp
set firewall ipv4 forward filter rule 201 destination port 53

{# Rule 210-211: DMZ-Web -> WAN (Limited) #}
set firewall ipv4 forward filter rule 210 action accept
set firewall ipv4 forward filter rule 210 description 'DMZ-Web HTTP/HTTPS for updates'
set firewall ipv4 forward filter rule 210 source address 10.0.12.0/24
set firewall ipv4 forward filter rule 210 outbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 210 protocol tcp
set firewall ipv4 forward filter rule 210 destination port 80,443

set firewall ipv4 forward filter rule 211 action accept
set firewall ipv4 forward filter rule 211 description 'DMZ-Web DNS'
set firewall ipv4 forward filter rule 211 source address 10.0.12.0/24
set firewall ipv4 forward filter rule 211 outbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 211 protocol udp
set firewall ipv4 forward filter rule 211 destination port 53

{# Rule 220-221: VPN -> WAN (Limited) #}
set firewall ipv4 forward filter rule 220 action accept
set firewall ipv4 forward filter rule 220 description 'VPN HTTP/HTTPS for updates'
set firewall ipv4 forward filter rule 220 source address 10.0.20.0/24
set firewall ipv4 forward filter rule 220 outbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 220 protocol tcp
set firewall ipv4 forward filter rule 220 destination port 80,443

set firewall ipv4 forward filter rule 221 action accept
set firewall ipv4 forward filter rule 221 description 'VPN DNS'
set firewall ipv4 forward filter rule 221 source address 10.0.20.0/24
set firewall ipv4 forward filter rule 221 outbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 221 protocol udp
set firewall ipv4 forward filter rule 221 destination port 53

{# Rule 300: WAN -> DMZ-Cloud (Port forwarded Nextcloud) #}
set firewall ipv4 forward filter rule 300 action accept
set firewall ipv4 forward filter rule 300 description 'WAN to Nextcloud HTTP/HTTPS'
set firewall ipv4 forward filter rule 300 inbound-interface name {{ wan_interface }}
set firewall ipv4 forward filter rule 300 destination address 10.0.11.10
set firewall ipv4 forward filter rule 300 protocol tcp
set firewall ipv4 forward filter rule 300 destination port 80,443

{# Rule 900+: Explicit denies for isolation (optional, default-drop handles this) #}
set firewall ipv4 forward filter rule 900 action drop
set firewall ipv4 forward filter rule 900 description 'Block DMZ-Cloud to DMZ-Web'
set firewall ipv4 forward filter rule 900 source address 10.0.11.0/24
set firewall ipv4 forward filter rule 900 destination address 10.0.12.0/24

set firewall ipv4 forward filter rule 901 action drop
set firewall ipv4 forward filter rule 901 description 'Block DMZ-Web to DMZ-Cloud'
set firewall ipv4 forward filter rule 901 source address 10.0.12.0/24
set firewall ipv4 forward filter rule 901 destination address 10.0.11.0/24

set firewall ipv4 forward filter rule 910 action drop
set firewall ipv4 forward filter rule 910 description 'Block DMZ-Cloud to MGMT'
set firewall ipv4 forward filter rule 910 source address 10.0.11.0/24
set firewall ipv4 forward filter rule 910 destination address 10.0.10.0/24

set firewall ipv4 forward filter rule 911 action drop
set firewall ipv4 forward filter rule 911 description 'Block DMZ-Web to MGMT'
set firewall ipv4 forward filter rule 911 source address 10.0.12.0/24
set firewall ipv4 forward filter rule 911 destination address 10.0.10.0/24

set firewall ipv4 forward filter rule 920 action drop
set firewall ipv4 forward filter rule 920 description 'Block VPN to MGMT'
set firewall ipv4 forward filter rule 920 source address 10.0.20.0/24
set firewall ipv4 forward filter rule 920 destination address 10.0.10.0/24

set firewall ipv4 forward filter rule 921 action drop
set firewall ipv4 forward filter rule 921 description 'Block VPN to DMZ-Cloud'
set firewall ipv4 forward filter rule 921 source address 10.0.20.0/24
set firewall ipv4 forward filter rule 921 destination address 10.0.11.0/24

set firewall ipv4 forward filter rule 922 action drop
set firewall ipv4 forward filter rule 922 description 'Block VPN to DMZ-Web'
set firewall ipv4 forward filter rule 922 source address 10.0.20.0/24
set firewall ipv4 forward filter rule 922 destination address 10.0.12.0/24
